---
import TinaAdminApp from '../../components/TinaAdminApp.jsx';
---

<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CRYPTORO Admin</title>
    <style>
      html,
      body {
        margin: 0;
        height: 100dvh;
        min-height: 100dvh;
        background: #f3f4f6;
        font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        overflow: hidden;
      }
      astro-island {
        display: block;
        height: 100dvh;
        min-height: 100dvh;
      }
      .tina-tailwind,
      [data-tina-root],
      [data-test='tina-admin'] {
        height: 100dvh !important;
        min-height: 100dvh !important;
      }
      .tina-tailwind main,
      [data-test='tina-admin'] main {
        overflow-y: auto !important;
        overscroll-behavior: contain;
      }
    </style>
  </head>
  <body>
    <TinaAdminApp client:only="react" />
    <script is:inline>
      (() => {
        const patchTinaLayout = () => {
          const root =
            document.querySelector('[data-test="tina-admin"]') ||
            document.querySelector('[data-tina-root]') ||
            document.querySelector('.tina-tailwind');

          if (!root) return;

          // Находим самый вероятный скролл-контейнер внутри Tina и включаем вертикальный скролл.
          const candidates = [root, ...root.querySelectorAll('main, [role="main"], div')];
          let best = null;
          let bestDelta = 0;
          for (const el of candidates) {
            const delta = el.scrollHeight - el.clientHeight;
            if (delta > bestDelta) {
              bestDelta = delta;
              best = el;
            }
          }
          if (best) {
            best.style.overflowY = 'auto';
            best.style.maxHeight = '100dvh';
            best.style.paddingBottom = '84px';
            best.style.scrollPaddingBottom = '84px';
          }

          // Фиксируем панель с кнопкой Save, чтобы она не уезжала вниз.
          const saveButtons = [...root.querySelectorAll('button')].filter((btn) =>
            /save|сохран/i.test(btn.textContent || '')
          );
          saveButtons.forEach((btn) => {
            const bar = btn.closest('div');
            if (!bar) return;
            bar.style.position = 'sticky';
            bar.style.bottom = '0';
            bar.style.zIndex = '999';
            bar.style.background = '#f3f4f6';
            bar.style.padding = '10px 12px';
            bar.style.borderTop = '1px solid rgba(17,24,39,.12)';
          });
        };

        window.addEventListener('load', patchTinaLayout);
        setTimeout(patchTinaLayout, 500);
        setTimeout(patchTinaLayout, 1500);
        window.setInterval(patchTinaLayout, 2000);
      })();
    </script>
  </body>
</html>
